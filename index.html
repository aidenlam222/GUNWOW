<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>3D Shooter Game</title>
  <style>
    body {margin:0; font-family:Arial, sans-serif; background:#111; color:#fff;}
    header, footer {text-align:center; padding:1em; background:#222;}
    #game-container {width:100%; height:80vh;}
    button {padding:10px 20px; margin:10px; font-size:16px; cursor:pointer;}
  </style>
</head>
<body>
  <header>
    <h1>3D Shooter Game</h1>
    <p>Use your controller or keyboard to move and shoot. Reach 500 points to win!</p>
  </header>
  <div id="game-container"></div>
  <footer>
    <button onclick="startGame()">Start Game</button>
  </footer>
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script>
    let scene, camera, renderer, playerObject, gun;
    let enemies = [], state = {health:100, score:0, gameOver:false};
    let clock = new THREE.Clock();
    let yaw=0, pitch=0;

    function startGame(){
      document.querySelector('button').disabled=true;
      init();
    }

    function init(){
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87ceeb);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth, window.innerHeight*0.8);
      document.getElementById('game-container').appendChild(renderer.domElement);

      playerObject = new THREE.Object3D();
      playerObject.position.set(0,2,0);
      scene.add(playerObject);
      camera.position.set(0,0,0);
      playerObject.add(camera);

      const gunGeometry = new THREE.BoxGeometry(0.1,0.1,0.4);
      const gunMaterial = new THREE.MeshStandardMaterial({color:0x222222});
      gun = new THREE.Mesh(gunGeometry, gunMaterial);
      gun.position.set(0,-0.1,-0.5);
      camera.add(gun);

      const hemi = new THREE.HemisphereLight(0xffffff,0x444422, 0.9);
      scene.add(hemi);
      const dir = new THREE.DirectionalLight(0xffffff,0.6);
      dir.position.set(5,10,2);
      scene.add(dir);

      const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000,1000), new THREE.MeshStandardMaterial({color:0x3a8d2a}));
      ground.rotation.x=-Math.PI/2; ground.position.y=0; scene.add(ground);

      for(let i=0;i<6;i++) spawnEnemy();

      window.addEventListener('resize', ()=>{
        camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight*0.8);
      });

      animate();
    }

    function spawnEnemy(){
      const g=new THREE.SphereGeometry(0.9,12,12);
      const m=new THREE.MeshStandardMaterial({color:0xff4444});
      const mesh=new THREE.Mesh(g,m);
      const angle=Math.random()*Math.PI*2; const r=20+Math.random()*60;
      mesh.position.set(Math.cos(angle)*r,0.9,Math.sin(angle)*r);
      mesh.userData={speed:1+Math.random()*0.8,hp:3};
      scene.add(mesh); enemies.push(mesh);
    }

    function shoot(){
      if(state.gameOver) return;
      const origin=new THREE.Vector3(); camera.getWorldPosition(origin);
      const dir=new THREE.Vector3(); camera.getWorldDirection(dir);
      const raycaster = new THREE.Raycaster(origin, dir);
      const intersects = raycaster.intersectObjects(enemies,false);
      if(intersects.length>0){ const enemy = intersects[0].object; enemy.userData.hp-=1; if(enemy.userData.hp<=0){ scene.remove(enemy); enemies.splice(enemies.indexOf(enemy),1); state.score+=10; spawnEnemy(); if(state.score>=500){ alert('You Win!'); resetGame(); } } }
    }

    function handleGamepad(){
      if(state.gameOver) return;
      const gp = navigator.getGamepads()[0]; if(!gp) return;
      const moveSpeed=8*0.016;
      const leftX = gp.axes[0]; const leftY = gp.axes[1];
      const rightX = gp.axes[2]; const rightY = gp.axes[3];
      const forward=new THREE.Vector3(0,0,-1).applyQuaternion(playerObject.quaternion); forward.y=0; forward.normalize();
      const right=new THREE.Vector3(1,0,0).applyQuaternion(playerObject.quaternion); right.y=0; right.normalize();
      const move=new THREE.Vector3(); move.addScaledVector(forward, -leftY*moveSpeed); move.addScaledVector(right, leftX*moveSpeed);
      playerObject.position.add(move);
      yaw -= rightX*0.05; pitch -= rightY*0.05; const maxPitch=Math.PI/2-0.01; pitch=Math.max(-maxPitch, Math.min(maxPitch,pitch));
      playerObject.rotation.y=yaw; camera.rotation.x=pitch;
      if(gp.buttons[7].pressed) shoot();
    }

    function animate(){
      requestAnimationFrame(animate); handleGamepad();
      if(state.gameOver) return;
      const dt=Math.min(0.05, clock.getDelta());
      for(let i=enemies.length-1;i>=0;i--){
        const e=enemies[i]; const toPlayer=new THREE.Vector3().subVectors(playerObject.position,e.position);
        const dist=toPlayer.length(); toPlayer.normalize(); e.position.addScaledVector(toPlayer,e.userData.speed*dt);
        if(dist<2.2){ state.health-=12*dt; if(state.health<=0){ state.health=0; alert('You Lose!'); resetGame(); } }
      }
      renderer.render(scene,camera);
    }

    function resetGame(){
      state.health=100; state.score=0; state.gameOver=false;
      playerObject.position.set(0,2,0);
      enemies.forEach(e=>scene.remove(e)); enemies=[];
      for(let i=0;i<6;i++) spawnEnemy();
    }
  </script>
</body>
</html>
